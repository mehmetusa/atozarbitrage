(()=>{var a={};a.id=3732,a.ids=[636,3220,3732],a.modules={361:a=>{"use strict";a.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},887:a=>{"use strict";a.exports=import("@fortawesome/react-fontawesome")},1242:a=>{"use strict";a.exports=require("redux-persist/integration/react")},1428:a=>{"use strict";a.exports=import("axios")},2015:a=>{"use strict";a.exports=require("react")},2326:a=>{"use strict";a.exports=require("react-dom")},2541:a=>{"use strict";a.exports=require("redux-persist/lib/storage")},2898:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.d(b,{A:()=>l});var e=c(8732),f=c(6761),g=c.n(f),h=c(3220),i=c(8136),j=c.n(i),k=a([h]);function l({message:a="Loading..."}){return(0,e.jsxs)("div",{className:j().wrapper,children:[(0,e.jsx)(h.motion.div,{animate:{rotate:360},transition:{repeat:1/0,duration:4,ease:"linear"},className:j().ring,children:(0,e.jsx)(g(),{src:"/img/Amazon-outer.png",alt:"Amazon Arbirtage Ring",fill:!0,className:j().ringImg})}),(0,e.jsx)("div",{className:j().inner,children:(0,e.jsx)(g(),{src:"/img/Amazon-inner.png",alt:"Baker",fill:!0,className:j().innerImg})}),(0,e.jsx)("p",{className:j().message,children:a})]})}h=(k.then?(await k)():k)[0],d()}catch(a){d(a)}})},3220:a=>{"use strict";a.exports=import("framer-motion")},3787:a=>{"use strict";a.exports=require("redux-persist")},3873:a=>{"use strict";a.exports=require("path")},4062:a=>{"use strict";a.exports=import("react-redux")},4075:a=>{"use strict";a.exports=require("zlib")},4131:a=>{"use strict";a.exports=import("@fortawesome/free-solid-svg-icons")},4722:a=>{"use strict";a.exports=require("next-auth/react")},5695:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{default:()=>u});var e=c(8732),f=c(4062),g=c(4233),h=c(6761),i=c.n(h),j=c(2015),k=c(6091),l=c(1586),m=c(1116),n=c(1428),o=c(887),p=c(4131),q=c(7975),r=c.n(q),s=c(2898),t=a([f,k,l,m,n,o,p,s]);[f,k,l,m,n,o,p,s]=t.then?(await t)():t;let v=["08:00–10:00","10:00–12:00","12:00–14:00","14:00–16:00","16:00–18:00","18:00–20:00"];function u(){let a=(0,f.useSelector)(a=>a.cart),b=(0,f.useSelector)(a=>a.user),c=(0,f.useDispatch)(),d=(0,g.useRouter)(),h=a.products?.reduce((a,b)=>a+Number(b.price||0)*Number(b.quantity||0),0)||0,q=h>=250?0:25,t=b.addresses?.length&&b.addresses[0]||{},[u,w]=(0,j.useState)(!b.isLoggedIn),[x,y]=(0,j.useState)(b.name||""),[z,A]=(0,j.useState)(b.email||""),[B,C]=(0,j.useState)(b.phone||""),[D,E]=(0,j.useState)(t.street||""),[F,G]=(0,j.useState)(t.city||""),[H,I]=(0,j.useState)(t.state||""),[J,K]=(0,j.useState)(t.zip||""),[L,M]=(0,j.useState)(t.country||"USA"),[N,O]=(0,j.useState)(""),[P,Q]=(0,j.useState)(""),[R,S]=(0,j.useState)(""),[T,U]=(0,j.useState)(b.couponCode||""),[V,W]=(0,j.useState)(0),[X,Y]=(0,j.useState)(""),[Z,$]=(0,j.useState)(!1),[_,aa]=(0,j.useState)(Math.round(.06*h*100)/100),[ab,ac]=(0,j.useState)(Math.round((h+_+q-V)*100)/100),ad=(a={})=>{b.isLoggedIn&&c((0,l.TK)({name:x,email:z,phone:B,addresses:[{street:D,city:F,state:H,zip:J,country:L}],deliveryDate:N,deliverySlot:P,couponCode:T,couponDiscount:V,notes:R,...a}))},ae=(0,j.useMemo)(()=>{let a=new Date;return a.setDate(a.getDate()+1),a.toISOString().split("T")[0]},[]),af=()=>({street:D,city:F,state:H,zip:J,country:L}),ag=async()=>{if(!T.trim())return Y("Enter a coupon code");try{let a=await n.default.post("/api/coupons/apply",{code:T.trim().toUpperCase(),userId:b.id,cartTotal:h});a.data.valid?(W(Number(a.data.discount||0)),Y(a.data.message||"Coupon applied!")):(W(0),Y(a.data.message||"Invalid coupon"))}catch(a){console.error(a),Y(a.response?.data?.message||"Failed to validate coupon"),W(0)}},ah=async(e=0)=>{if(!(x&&z&&D&&F&&H&&J&&L?N&&P?!!a.products?.length||(alert("Your cart is empty."),!1):(alert("Please select delivery date & slot."),!1):(alert("Please fill in all name, email, and address fields."),!1)))return;$(!0);let f={userId:b.isLoggedIn?b.id:null,customer:{name:x,email:z,phone:B,address:af()},items:(a.products||[]).map(a=>({productId:a._id,title:a.title||"Untitled",quantity:Number(a.quantity||0),price:Number(a.price||0),totalPrice:Math.round(Number(a.quantity||0)*Number(a.price||0)*100)/100,size:a.size||"Standard",extras:(a.extras||[]).map(a=>({text:a.text,price:Number(a.price||0)})),notes:a?.notes||"",whom:a?.whom||"",image:a.img||"/img/placeholder.png"})),subtotal:h,tax:_,total:ab,method:e,couponCode:T.trim()||null,notes:R.trim(),metadata:{deliveryDate:N,deliverySlot:P,...af()},discount:V};try{let a=await n.default.post(1===e?"/api/stripe/create-checkout-session":"/api/orders",f),b=a.data._id||a.data.order?._id;1===e&&a.data?.url?window.location.href=a.data.url:201===a.status?(c((0,k.cL)()),await m.q.flush(),d.push(`/orders/${b}`)):alert("Failed to place order.")}catch(a){console.error(a.response?.data||a.message),alert(a.response?.data?.message||"Failed to place order.")}finally{$(!1)}};return(0,e.jsxs)("div",{className:r().checkoutWrapper,children:[Z&&(0,e.jsx)("div",{className:r().loadingOverlay,children:(0,e.jsx)(s.A,{message:"Verifying payment and saving order..."})}),(0,e.jsxs)("div",{className:r().container,children:[(0,e.jsxs)("div",{className:r().topActions,children:[(0,e.jsx)("button",{className:r().backButton,onClick:()=>d.push("/cart"),children:(0,e.jsx)(o.FontAwesomeIcon,{icon:p.faArrowLeft})}),(0,e.jsx)("h1",{className:r().title,children:"Checkout"})]}),(0,e.jsxs)("div",{children:[!b.isLoggedIn&&(0,e.jsx)("h3",{children:"Please login to prefill your info, or checkout as guest:"}),(0,e.jsxs)("div",{className:r().loginPrompt,children:[!b.isLoggedIn&&(0,e.jsx)(e.Fragment,{children:(0,e.jsx)("div",{className:r().guest,children:(0,e.jsxs)("label",{children:[(0,e.jsx)("input",{type:"checkbox",checked:u,onChange:()=>w(!u)})," ","Guest User"]})})}),(0,e.jsx)("div",{children:!b.isLoggedIn&&!u&&(0,e.jsx)("button",{className:r().login,onClick:()=>d.push("/login"),children:"Login"})})]})]}),(b.isLoggedIn||u)&&(0,e.jsxs)("div",{className:r().userInfo,children:[(0,e.jsx)("h2",{children:"Delivery Address"}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Name"}),(0,e.jsx)("input",{value:x,onChange:a=>y(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Email"}),(0,e.jsx)("input",{value:z,onChange:a=>A(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Phone"}),(0,e.jsx)("input",{value:B,onChange:a=>C(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Street"}),(0,e.jsx)("input",{value:D,onChange:a=>E(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"City"}),(0,e.jsx)("input",{value:F,onChange:a=>G(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"State"}),(0,e.jsx)("input",{value:H,onChange:a=>I(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"ZIP"}),(0,e.jsx)("input",{value:J,onChange:a=>K(a.target.value)})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Country"}),(0,e.jsx)("input",{value:L,onChange:a=>M(a.target.value)})]})]}),(0,e.jsxs)("div",{className:r().cartItems,children:[(0,e.jsx)("h2",{children:"Cart Items"}),a.products?.length?(0,e.jsxs)(e.Fragment,{children:[(0,e.jsxs)("table",{className:r().cartTable,children:[(0,e.jsx)("thead",{children:(0,e.jsxs)("tr",{children:[(0,e.jsx)("th",{children:"Picture"}),(0,e.jsx)("th",{children:"Title"}),(0,e.jsx)("th",{children:"Qty"}),(0,e.jsx)("th",{children:"Unit Price"}),(0,e.jsx)("th",{children:"Total"})]})}),(0,e.jsx)("tbody",{children:a.products.map((a,b)=>(0,e.jsxs)("tr",{children:[(0,e.jsx)("td",{children:(0,e.jsx)(i(),{src:a.img||"/img/placeholder.png",width:50,height:50,alt:a.title,style:{borderRadius:6,objectFit:"cover"}})}),(0,e.jsxs)("td",{children:[a.title," ",a.extras?.map(a=>(0,e.jsxs)("span",{children:["+",a.text]},a.text))]}),(0,e.jsx)("td",{children:a.quantity}),(0,e.jsxs)("td",{children:["$",a.price.toFixed(2)]}),(0,e.jsxs)("td",{children:["$",(a.price*a.quantity).toFixed(2)]})]},`${a._id}-${b}`))})]}),(0,e.jsx)("div",{className:r().cartCardList,children:a.products.map((a,b)=>(0,e.jsxs)("div",{className:r().cartCard,children:[(0,e.jsxs)("div",{className:r().cartCardTop,children:[(0,e.jsx)(i(),{src:a.img||"/img/placeholder.png",width:60,height:60,alt:a.title}),(0,e.jsxs)("div",{className:r().cartCardInfo,children:[(0,e.jsx)("span",{className:r().title,children:a.title}),(0,e.jsx)("div",{className:r().extras,children:a.extras?.map(a=>(0,e.jsxs)("span",{children:["+",a.text]},a.text))})]})]}),(0,e.jsxs)("div",{className:r().cartCardBottom,children:[(0,e.jsxs)("span",{children:[a.quantity," \xd7 $",a.price.toFixed(2)]}),(0,e.jsxs)("span",{children:["$",(a.price*a.quantity).toFixed(2)]})]})]},`${a._id}-${b}`))})]}):(0,e.jsx)("p",{style:{textAlign:"center",marginTop:20},children:"Your cart is empty."})]}),(0,e.jsxs)("div",{className:r().deliveryCard,children:[(0,e.jsx)("h2",{children:"Schedule Delivery"}),(0,e.jsxs)("div",{className:r().deliveryGrid,children:[(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Delivery Date"}),(0,e.jsx)("div",{className:r().inputWithIconLarge,children:(0,e.jsx)("input",{type:"date",placeholder:"MM/DD/YYYY",min:ae,value:N,onChange:a=>{O(a.target.value),ad()}})})]}),(0,e.jsxs)("div",{className:r().field,children:[(0,e.jsx)("label",{children:"Time Slot"}),(0,e.jsx)("div",{className:r().inputWithIconLarge,children:(0,e.jsxs)("select",{value:P,onChange:a=>{Q(a.target.value),ad()},children:[(0,e.jsx)("option",{value:"",children:"Select a 2-hour slot"}),v.map(a=>(0,e.jsx)("option",{value:a,children:a},a))]})})]})]})]}),(0,e.jsxs)("div",{className:r().notesSection,children:[(0,e.jsx)("h2",{children:"Order Notes"}),(0,e.jsx)("textarea",{placeholder:"Add any special instructions for your order...",value:R,onChange:a=>S(a.target.value),rows:4})]}),(0,e.jsxs)("div",{className:r().orderSummary,children:[(0,e.jsx)("h2",{children:"Order Summary"}),(0,e.jsxs)("div",{className:r().orderSummaryRow,children:[(0,e.jsx)("span",{children:"Subtotal:"}),(0,e.jsxs)("span",{children:["$",h.toFixed(2)]})]}),V>0&&(0,e.jsxs)("div",{className:r().orderSummaryRow,children:[(0,e.jsx)("span",{children:"Coupon Discount:"}),(0,e.jsxs)("span",{children:["- $",V.toFixed(2)]})]}),(0,e.jsxs)("div",{className:r().orderSummaryRow,children:[(0,e.jsx)("span",{children:"Tax (6%):"}),(0,e.jsxs)("span",{children:["$",_.toFixed(2)]})]}),(0,e.jsxs)("div",{className:r().orderSummaryRow,children:[(0,e.jsx)("span",{children:"Shipping:"}),0===q?(0,e.jsx)("span",{className:r().freeShipping,children:"FREE"}):(0,e.jsxs)("span",{children:["$",q.toFixed(2)]})]}),(0,e.jsxs)("div",{className:`${r().orderSummaryRow} ${r().total}`,children:[(0,e.jsx)("span",{children:"Total:"}),(0,e.jsxs)("span",{children:["$",ab.toFixed(2)]})]}),(0,e.jsxs)("div",{className:r().couponSection,children:[(0,e.jsx)("input",{type:"text",placeholder:"Coupon Code",value:T,onChange:a=>U(a.target.value.toUpperCase()),disabled:V>0}),(0,e.jsx)("button",{onClick:ag,disabled:!T.trim()||V>0,children:"Apply"}),V>0&&(0,e.jsx)("button",{onClick:async()=>{try{await n.default.put("/api/coupons/remove",{code:T,userId:b.id}),W(""),U(""),Y(""),((a=V)=>{let b=Math.round((h-a)*6)/100,c=Math.round((h-a+b+q)*100)/100;aa(b),ac(c)})(0),ad({couponCode:"",couponDiscount:0})}catch(a){console.error(a),Y("Failed to remove coupon")}},className:r().removeCoupon,children:"Remove"}),X&&(0,e.jsx)("p",{className:V>0?r().couponSuccess:r().couponError,children:X})]})]}),(0,e.jsxs)("div",{className:r().payButtons,children:[(0,e.jsx)("h2",{children:"Payment Methods"}),(0,e.jsx)(i(),{src:"/img/cash.png",alt:"Cash on Delivery",width:200,height:60,style:{cursor:"pointer"},onClick:()=>ah(0)}),(0,e.jsx)(i(),{src:"/img/credit.png",alt:"Pay with Stripe",width:240,height:60,style:{cursor:"pointer"},onClick:()=>ah(1)})]})]})]})}d()}catch(a){d(a)}})},6060:a=>{"use strict";a.exports=require("next/dist/shared/lib/no-fallback-error.external.js")},6401:a=>{"use strict";a.exports=require("next-seo")},7910:a=>{"use strict";a.exports=require("stream")},7975:a=>{a.exports={container:"Checkout_container__kMQTA",topActions:"Checkout_topActions__TjTeV",backButton:"Checkout_backButton__1aZGS",title:"Checkout_title__oMtc1",guest:"Checkout_guest___R_Lk",userInfo:"Checkout_userInfo__IIqQI",deliveryCard:"Checkout_deliveryCard__hlswl",cartItems:"Checkout_cartItems__EnGPz",orderSummary:"Checkout_orderSummary__QF6Nn",payButtons:"Checkout_payButtons__j8eF_",field:"Checkout_field__sAuL3",inputWithIcon:"Checkout_inputWithIcon__cAZFq",icon:"Checkout_icon__Bh0UE",cartTable:"Checkout_cartTable__s4U5W",deliveryGrid:"Checkout_deliveryGrid__PIAjp",orderSummaryRow:"Checkout_orderSummaryRow__iskfM",total:"Checkout_total__uMZge",couponSection:"Checkout_couponSection__aDG6c",couponSuccess:"Checkout_couponSuccess__taNnb",couponError:"Checkout_couponError__bhoNx",freeShipping:"Checkout_freeShipping__alU_d",shippingNote:"Checkout_shippingNote__2h3cr",shippingSaved:"Checkout_shippingSaved__ViyJq",paymentOption1:"Checkout_paymentOption1__Xtf1b",paymentOption2:"Checkout_paymentOption2__jCaF8",whomSection:"Checkout_whomSection___DDNC",notesSection:"Checkout_notesSection__wCJ3I",inputWithIconLarge:"Checkout_inputWithIconLarge__dR2nD",iconLarge:"Checkout_iconLarge__7LZ_V",checkoutWrapper:"Checkout_checkoutWrapper__iNQSK",loadingOverlay:"Checkout_loadingOverlay__qBGPJ",login:"Checkout_login__lyP6H",loginPrompt:"Checkout_loginPrompt__ROUvs",cartCard:"Checkout_cartCard__mbqS3",cartCardTop:"Checkout_cartCardTop__HnRax",cartCardInfo:"Checkout_cartCardInfo__A4XcN",extras:"Checkout_extras__JfUrR",cartCardBottom:"Checkout_cartCardBottom__HNPKd",cartCardList:"Checkout_cartCardList__FF1ZA"}},8136:a=>{a.exports={wrapper:"LoadingSpinner_wrapper__H5N5p",ring:"LoadingSpinner_ring__xh1P9",ringImg:"LoadingSpinner_ringImg__bUgON",inner:"LoadingSpinner_inner__wyHgX",innerImg:"LoadingSpinner_innerImg__DK6h4",message:"LoadingSpinner_message__o_zuw"}},8732:a=>{"use strict";a.exports=require("react/jsx-runtime")},9021:a=>{"use strict";a.exports=require("fs")},9198:a=>{"use strict";a.exports=import("@reduxjs/toolkit")},9565:(a,b,c)=>{"use strict";c.a(a,async(a,d)=>{try{c.r(b),c.d(b,{config:()=>r,default:()=>n,getServerSideProps:()=>q,getStaticPaths:()=>p,getStaticProps:()=>o,handler:()=>z,reportWebVitals:()=>s,routeModule:()=>y,unstable_getServerProps:()=>w,unstable_getServerSideProps:()=>x,unstable_getStaticParams:()=>v,unstable_getStaticPaths:()=>u,unstable_getStaticProps:()=>t});var e=c(3885),f=c(237),g=c(1413),h=c(3317),i=c.n(h),j=c(6095),k=c(5695),l=c(2289),m=a([j,k]);[j,k]=m.then?(await m)():m;let n=(0,g.M)(k,"default"),o=(0,g.M)(k,"getStaticProps"),p=(0,g.M)(k,"getStaticPaths"),q=(0,g.M)(k,"getServerSideProps"),r=(0,g.M)(k,"config"),s=(0,g.M)(k,"reportWebVitals"),t=(0,g.M)(k,"unstable_getStaticProps"),u=(0,g.M)(k,"unstable_getStaticPaths"),v=(0,g.M)(k,"unstable_getStaticParams"),w=(0,g.M)(k,"unstable_getServerProps"),x=(0,g.M)(k,"unstable_getServerSideProps"),y=new e.PagesRouteModule({definition:{kind:f.RouteKind.PAGES,page:"/checkout",pathname:"/checkout",bundlePath:"",filename:""},distDir:".next",relativeProjectDir:"",components:{App:j.default,Document:i()},userland:k}),z=(0,l.U)({srcPage:"/checkout",config:r,userland:k,routeModule:y,getStaticPaths:p,getStaticProps:o,getServerSideProps:q});d()}catch(a){d(a)}})},9756:a=>{"use strict";a.exports=import("redux")}};var b=require("../webpack-runtime.js");b.C(a);var c=b.X(0,[6238,9765,3317,5781,6095],()=>b(b.s=9565));module.exports=c})();